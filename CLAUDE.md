# RO-Crate API Downloader

This codebase provides guidance to Claude Code when working on this project.

## Project Overview

A web application for browsing RO-Crate collections hierarchically, selecting files with quality tier filtering, and requesting zip downloads via email.

## Tech Stack

- **Frontend:** React 19, Shadcn/ui, Tailwind CSS 4, TanStack Query, TanStack Router, Zustand
- **Backend:** Hono (serves SPA from same server)
- **Auth:** Generic OIDC (configurable via env)
- **Infrastructure:** AWS S3 (zip storage), AWS SES (email), AWS SQS (job queue)

## Project Structure

```
src/
├── client/           # React SPA
│   ├── routes/       # TanStack Router file-based routes
│   ├── components/   # React components
│   │   ├── ui/       # shadcn/ui base components
│   │   ├── browser/  # Collection/item/file browser
│   │   ├── layout/   # Header, Footer
│   │   └── common/   # LoadingSpinner, FileSize
│   ├── hooks/        # TanStack Query hooks
│   ├── lib/          # API client, utilities
│   └── store/        # Zustand stores
├── server/           # Hono backend
│   ├── routes/       # API routes (auth, api, export)
│   └── services/     # RO-Crate client, SQS
├── worker/           # SQS worker process
│   └── services/     # S3, SES, zipper, RO-Crate fetcher
└── shared/           # Shared types, schemas, utilities
```

## Development Commands

```bash
pnpm dev          # Run frontend + backend concurrently
pnpm dev:client   # Run Vite dev server only
pnpm dev:server   # Run Hono server with watch mode
pnpm build        # Build for production
pnpm worker       # Run SQS worker process
pnpm typecheck    # Run TypeScript type checking
```

## Environment Variables

Copy `.env.example` to `.env` and configure:

- `ROCRATE_API_BASE_URL` - RO-Crate API endpoint
- `OIDC_*` - OIDC authentication settings
- `SESSION_SECRET` - Session encryption key (min 32 chars)
- `AWS_*` - AWS credentials and region
- `SQS_QUEUE_URL` - SQS queue for export jobs
- `S3_BUCKET` - S3 bucket for zip files
- `EMAIL_FROM` - Email sender address

## Key Patterns

### Data Flow

1. Frontend fetches collections via `/api/collections`
2. User expands collections to load items via `/api/collections/:id/items`
3. User expands items to load files via `/api/items/:id/files`
4. Selection state stored in Zustand, filtered by quality preferences
5. Export submits file IDs to SQS queue
6. Worker fetches files, creates zip, uploads to S3, emails link

### State Management

- **Server state:** TanStack Query for all API data (collections, items, files)
- **Client state:** Zustand for selection, expansion, and quality preferences

### Type Safety

- Shared types in `src/shared/types/`
- Zod schemas in `src/shared/schemas/` for runtime validation
- TypeScript strict mode enabled

## Path Aliases

- `@/*` - `src/client/*`
- `@shared/*` - `src/shared/*`

## Notes

- The route tree (`src/client/routeTree.gen.ts`) is auto-generated by TanStack Router plugin
- Authentication is currently stubbed - implement OIDC callback handling in production
- SQS worker runs as a separate process (`pnpm worker`)
